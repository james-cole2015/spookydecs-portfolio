<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SpookyDecs â€” Items Management</title>
  <style>
    /* Neutral theme (Halloween + Christmas fusion) */
    :root {
      --accent: #9146ff;
      --accent2: #0ea5e9;
      --neutral-bg: linear-gradient(135deg, #fafafa 0%, #fff8f0 100%);
      --text-dark: #1f2937;
      --halloween: #e87c1e;
      --christmas: #2b7a0b;
    }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, Segoe UI, Roboto, Arial;
      margin: 16px;
      background: var(--neutral-bg);
      color: var(--text-dark);
      min-height: 100vh;
    }
    header {
      padding: 18px;
      display: flex;
      align-items: center;
      gap: 12px;
      background: linear-gradient(90deg, #b3e5fc 0%, #81d4fa 100%);
      border: 1px solid white;
      color: #0f172a;
      border-radius: 10px;
      margin-bottom: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }
    h1 { margin: 0; font-size: 20px; }
    h2 { margin: 0 0 12px 0; font-size: 16px; color: #374151; }
    
    /* Stats Cards Section */
    .stats-section { margin-bottom: 16px; }
    .stats-label { font-size: 13px; font-weight: 600; color: #6b7280; margin-bottom: 8px; }
    .cards { display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
    .card {
      background: white;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,.06);
      min-width: 140px;
      transition: transform .15s;
      flex: 1;
      min-width: 100px;
    }
    .card:hover { transform: translateY(-3px); }
    .card-value { font-size: 24px; font-weight: 700; color: #1f2937; margin-bottom: 4px; }
    .card-label { font-size: 12px; color: #6b7280; }
    
    /* Controls */
    .controls { 
      display: flex; 
      gap: 8px; 
      align-items: center; 
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    button { 
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #ddd;
      background: white;
      cursor: pointer;
      transition: all .12s;
      font-size: 14px;
    }
    button:hover { background: #f3f4f6; }
    button.btn-primary,
    button.btn-create {
      background: #b3e5fc;
      color: #0f172a;
      border: 1px solid white;
      font-weight: 500;
    }
    button.btn-primary:hover,
    button.btn-create:hover {
      background: #81d4fa;
    }
    button.btn-secondary {
      background: #e0e0e0;
      color: #0f172a;
      border: 1px solid #ccc;
    }
    button.btn-secondary:hover {
      background: #d0d0d0;
    }
    button.btn-danger {
      background: #fee;
      color: #991b1b;
      border: 1px solid #fca5a5;
    }
    button.btn-danger:hover {
      background: #fdd;
    }
    
    /* Table */
    .table { 
      background: white;
      border-radius: 8px;
      overflow: auto;
      box-shadow: 0 1px 3px rgba(0,0,0,.06);
    }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px; border-bottom: 1px solid #eee; text-align: left; }
    th { background: #fafafa; font-size: 13px; font-weight: 600; }
    td { font-size: 14px; }
    
    /* Badges */
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 500;
    }
    .badge.active { background: #e6ffed; color: #065f46; }
    .badge.inactive { background: #f3f4f6; color: #6b7280; }
    .badge.halloween { background: #fed7aa; color: #9a3412; }
    .badge.christmas { background: #d1fae5; color: #065f46; }
    .badge.shared { background: #dbeafe; color: #1e40af; }
    .badge.needs-repair { background: #fee2e2; color: #991b1b; }
    .badge.ok { background: #e6ffed; color: #065f46; }
    
    /* Action Buttons */
    .action-buttons { display: flex; gap: 4px; }
    .btn-small { 
      padding: 4px 8px; 
      font-size: 12px;
      border-radius: 4px;
    }
    
    /* Modal */
    .modal {
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,.4);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal .panel {
      background: white;
      padding: 16px;
      border-radius: 8px;
      max-width: 600px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      border-top: 6px solid var(--halloween);
    }
    .modal .panel.view-panel {
      max-width: 800px;
      margin: 0 auto;
    }
    .modal .panel.view-panel.expanded {
      max-width: 1000px;
      margin: 0 auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .modal-footer {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #eee;
    }
    
    /* View Modal Specific Styles */
    .view-item-id {
      text-align: center;
      font-size: 18px;
      color: #1f2937;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 2px solid #eee;
      font-weight: 700;
    }
    .view-content {
      display: grid;
      /*grid-template-columns: 1fr 1fr;*/
      grid-template-columns: repeat(2, max-content); /* columns only as wide as their content, from chat gpt */
      gap: 24px;
      justify-content: center; /*chat gpt add */
      margin-bottom: 16px;
    }
    .view-section h3 {
      font-size: 14px;
      font-weight: 600;
      color: #374151;
      margin: 0 0 12px 0;
      align-items: center; /* chat gpt add */
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .view-field {
      margin-bottom: 12px;
      display: flex;
      align-items: start;
      gap: 8px;
    }
    .view-field-label {
      font-size: 13px;
      color: #6b7280;
      font-weight: 600;
      min-width: 120px;
      flex-shrink: 0;
    }
    .view-field-value {
      font-size: 14px;
      color: #1f2937;
      font-weight: 400;
      flex: 1;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .view-field-value.needs-repair-yes {
      background: #fee;
      color: #991b1b;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 700;
      display: inline-flex;
      width: fit-content;
    }
    .type-icon {
      font-size: 16px;
    }
    .expanded-content {
      display: none;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 2px solid #eee;
    }
    .expanded-content.show {
      display: block;
    }
    .expanded-section {
      margin-bottom: 20px;
    }
    .expanded-section h4 {
      font-size: 13px;
      font-weight: 600;
      color: #374151;
      margin: 0 0 8px 0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      min-height: 18px;
    }
    .expanded-field {
      margin-bottom: 8px;
      display: flex;
      align-items: start;
      gap: 8px;
      padding-left: 12px;
    }
    .expanded-field-label {
      font-size: 12px;
      color: #6b7280;
      font-weight: 500;
      min-width: 100px;
    }
    .expanded-field-value {
      font-size: 13px;
      color: #1f2937;
      flex: 1;
    }
    .list-item {
      padding: 4px 0;
      font-size: 13px;
      color: #1f2937;
    }
    
    /* Mobile Cards */
    .item-cards { display: none; }
    .item-card {
      background: white;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,.06);
      margin-bottom: 12px;
    }
    .item-card-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 8px;
    }
    .item-card-name {
      font-weight: 600;
      font-size: 16px;
      color: #1f2937;
    }
    .item-card-row {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
      font-size: 13px;
    }
    .item-card-label {
      color: #6b7280;
      font-weight: 500;
    }
    
    .small { font-size: 12px; color: #6b7280; }
    .muted { opacity: .9; color: rgba(255,255,255,0.9); }
    
    /* Mobile Responsive */
    @media (max-width: 768px) {
      .table { display: none; }
      .item-cards { display: block; }
      .cards { gap: 8px; }
      .card { 
        min-width: 80px;
        padding: 8px;
      }
      .card-value { font-size: 20px; }
      .card-label { font-size: 11px; }
      .stats-label { font-size: 12px; }
      h1 { font-size: 18px; }
      header { flex-wrap: wrap; }
      
      .modal .panel {
        width: 95%;
        max-height: 95vh;
      }
      .view-content {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      .expanded-content > div[style*="grid-template-columns"] {
        grid-template-columns: 1fr !important;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>SpookyDecs â€” Items Management</h1>
  <div style="flex:1"></div>
  <div id="authInfo" class="small muted">Admin User</div>
  <a id="adminLink" href="#" style="color:#0f172a;text-decoration:none;padding:8px 10px;background:white;border-radius:6px;font-size:14px;border:1px solid #ddd;">Admin</a>
  <button id="btnLogout" style="background:#2b2b2b;color:white;">Logout</button>
</header>

<script>
(function() {
  const faviconUrl = "https://assets.spookydecs.com/icons/person-gear_icon.svg";
  const link = document.createElement('link');
  link.rel = 'icon';
  link.type = 'image/svg+xml';
  link.href = faviconUrl;
  document.head.appendChild(link);
})();

</script>

<!-- Season Stats -->
<div class="stats-section">
  <div class="stats-label">By Season</div>
  <div class="cards">
    <div class="card">
      <div class="card-value" id="stat-halloween">12</div>
      <div class="card-label">Halloween</div>
    </div>
    <div class="card">
      <div class="card-value" id="stat-christmas">8</div>
      <div class="card-label">Christmas</div>
    </div>
    <div class="card">
      <div class="card-value" id="stat-shared">5</div>
      <div class="card-label">Shared</div>
    </div>
  </div>
</div>

<!-- Class Type Stats -->
<div class="stats-section">
  <div class="stats-label">By Class Type</div>
  <div class="cards">
    <div class="card">
      <div class="card-value" id="stat-cord">3</div>
      <div class="card-label">Cord</div>
    </div>
    <div class="card">
      <div class="card-value" id="stat-inflatable">4</div>
      <div class="card-label">Inflatable</div>
    </div>
    <div class="card">
      <div class="card-value" id="stat-plug">2</div>
      <div class="card-label">Plug</div>
    </div>
    <div class="card">
      <div class="card-value" id="stat-static">5</div>
      <div class="card-label">Static Prop</div>
    </div>
    <div class="card">
      <div class="card-value" id="stat-animatronic">3</div>
      <div class="card-label">Animatronic</div>
    </div>
    <div class="card">
      <div class="card-value" id="stat-light">6</div>
      <div class="card-label">Light</div>
    </div>
    <div class="card">
      <div class="card-value" id="stat-adapter">2</div>
      <div class="card-label">Adapter</div>
    </div>
  </div>
</div>

<!-- Class Stats -->
<div class="stats-section">
  <div class="stats-label">By Class</div>
  <div class="cards">
    <div class="card">
      <div class="card-value" id="stat-accessory">8</div>
      <div class="card-label">Accessory</div>
    </div>
    <div class="card">
      <div class="card-value" id="stat-decoration">12</div>
      <div class="card-label">Decoration</div>
    </div>
    <div class="card">
      <div class="card-value" id="stat-light-class">5</div>
      <div class="card-label">Light</div>
    </div>
  </div>
</div>

<!-- Controls -->
<div class="controls">
  <button class="btn-create" id="btnCreateItem">+ Create Item</button>
  <button class="btn-danger" id="btnDeleteItem">Delete Item</button>
  <div style="flex:1"></div>
  <input type="text" id="searchInput" placeholder="Search items..." style="min-width: 200px;">
</div>

<!-- Desktop Table View -->
<div class="table">
  <table id="itemsTable">
    <thead>
      <tr>
        <th>Status</th>
        <th>Name</th>
        <th>Season</th>
        <th>Class Type</th>
        <th>Repair Status</th>
        <th>Location</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <!-- Sample Data -->
      <tr>
        <td><span class="badge active">Active</span></td>
        <td>12ft Skeleton</td>
        <td><span class="badge halloween">Halloween</span></td>
        <td>Static Prop</td>
        <td><span class="badge ok">OK</span></td>
        <td>Garage - A3</td>
        <td>
          <div class="action-buttons">
            <button class="btn-small btn-primary" onclick="viewItem(1)">View</button>
            <button class="btn-small btn-secondary" onclick="editItem(1)">Edit</button>
          </div>
        </td>
      </tr>
      <tr>
        <td><span class="badge active">Active</span></td>
        <td>Santa Inflatable</td>
        <td><span class="badge christmas">Christmas</span></td>
        <td>Inflatable</td>
        <td><span class="badge needs-repair">Needs Repair</span></td>
        <td>Basement - B1</td>
        <td>
          <div class="action-buttons">
            <button class="btn-small btn-primary" onclick="viewItem(2)">View</button>
            <button class="btn-small btn-secondary" onclick="editItem(2)">Edit</button>
          </div>
        </td>
      </tr>
      <tr>
        <td><span class="badge active">Active</span></td>
        <td>LED String Lights</td>
        <td><span class="badge shared">Shared</span></td>
        <td>Light</td>
        <td><span class="badge ok">OK</span></td>
        <td>Attic - C2</td>
        <td>
          <div class="action-buttons">
            <button class="btn-small btn-primary" onclick="viewItem(3)">View</button>
            <button class="btn-small btn-secondary" onclick="editItem(3)">Edit</button>
          </div>
        </td>
      </tr>
      <tr>
        <td><span class="badge inactive">Inactive</span></td>
        <td>Pumpkin Animatronic</td>
        <td><span class="badge halloween">Halloween</span></td>
        <td>Animatronic</td>
        <td><span class="badge ok">OK</span></td>
        <td>Garage - A1</td>
        <td>
          <div class="action-buttons">
            <button class="btn-small btn-primary" onclick="viewItem(4)">View</button>
            <button class="btn-small btn-secondary" onclick="editItem(4)">Edit</button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Mobile Card View -->
<div class="item-cards" id="itemCards">
  <div class="item-card">
    <div class="item-card-header">
      <div class="item-card-name">12ft Skeleton</div>
      <span class="badge active">Active</span>
    </div>
    <div class="item-card-row">
      <span class="item-card-label">Season:</span>
      <span class="badge halloween">Halloween</span>
    </div>
    <div class="item-card-row">
      <span class="item-card-label">Class Type:</span>
      <span>Static Prop</span>
    </div>
    <div class="item-card-row">
      <span class="item-card-label">Repair Status:</span>
      <span class="badge ok">OK</span>
    </div>
    <div class="item-card-row">
      <span class="item-card-label">Location:</span>
      <span>Garage - A3</span>
    </div>
    <div class="action-buttons" style="margin-top: 8px;">
      <button class="btn-small btn-primary" onclick="viewItem(1)">View</button>
      <button class="btn-small btn-secondary" onclick="editItem(1)">Edit</button>
    </div>
  </div>
  
  <div class="item-card">
    <div class="item-card-header">
      <div class="item-card-name">Santa Inflatable</div>
      <span class="badge active">Active</span>
    </div>
    <div class="item-card-row">
      <span class="item-card-label">Season:</span>
      <span class="badge christmas">Christmas</span>
    </div>
    <div class="item-card-row">
      <span class="item-card-label">Class Type:</span>
      <span>Inflatable</span>
    </div>
    <div class="item-card-row">
      <span class="item-card-label">Repair Status:</span>
      <span class="badge needs-repair">Needs Repair</span>
    </div>
    <div class="item-card-row">
      <span class="item-card-label">Location:</span>
      <span>Basement - B1</span>
    </div>
    <div class="action-buttons" style="margin-top: 8px;">
      <button class="btn-small btn-primary" onclick="viewItem(2)">View</button>
      <button class="btn-small btn-secondary" onclick="editItem(2)">Edit</button>
    </div>
  </div>
  
  <div class="item-card">
    <div class="item-card-header">
      <div class="item-card-name">LED String Lights</div>
      <span class="badge active">Active</span>
    </div>
    <div class="item-card-row">
      <span class="item-card-label">Season:</span>
      <span class="badge shared">Shared</span>
    </div>
    <div class="item-card-row">
      <span class="item-card-label">Class Type:</span>
      <span>Light</span>
    </div>
    <div class="item-card-row">
      <span class="item-card-label">Repair Status:</span>
      <span class="badge ok">OK</span>
    </div>
    <div class="item-card-row">
      <span class="item-card-label">Location:</span>
      <span>Attic - C2</span>
    </div>
    <div class="action-buttons" style="margin-top: 8px;">
      <button class="btn-small btn-primary" onclick="viewItem(3)">View</button>
      <button class="btn-small btn-secondary" onclick="editItem(3)">Edit</button>
    </div>
  </div>
</div>

<!-- View Modal (Placeholder) -->
<div id="viewModal" class="modal" style="display:none;">
  <div class="panel view-panel" id="viewPanel">
    <div class="modal-header">
      <h2>Item Details</h2>
      <button onclick="closeModal('viewModal')" style="background:transparent;border:none;font-size:20px;cursor:pointer;">&times;</button>
    </div>
    
    <div class="view-item-id" id="viewItemId">ITEM-XXX-XXXX</div>
    
    <div class="view-content">
      <div class="view-section">
        <h3>Basic Information</h3>
        <div class="view-field">
          <div class="view-field-label">Name:</div>
          <div class="view-field-value" id="view-short-name">-</div>
        </div>
        <div class="view-field">
          <div class="view-field-label">Season:</div>
          <div class="view-field-value" id="view-season">-</div>
        </div>
        <div class="view-field">
          <div class="view-field-label">Class:</div>
          <div class="view-field-value" id="view-class">-</div>
        </div>
        <div class="view-field">
          <div class="view-field-label">Type:</div>
          <div class="view-field-value" id="view-class-type">-</div>
        </div>
      </div>
      
      <div class="view-section">
        <h3>Status & Location</h3>
        <div class="view-field">
          <div class="view-field-label">Status:</div>
          <div class="view-field-value" id="view-status">-</div>
        </div>
        <div class="view-field">
          <div class="view-field-label">Needs Repair:</div>
          <div class="view-field-value" id="view-needs-repair">-</div>
        </div>
        <div class="view-field">
          <div class="view-field-label">Item Notes:</div>
          <div class="view-field-value" id="view-general-notes">-</div>
        </div>
        <div class="view-field">
          <div class="view-field-label">Storage Location:</div>
          <div class="view-field-value" id="view-tote-location">-</div>
        </div>
        <div class="view-field">
          <div class="view-field-label">Last Deployment:</div>
          <div class="view-field-value" id="view-last-deployment">-</div>
        </div>
      </div>
    </div>
    
    <div class="expanded-content" id="expandedContent">
      <h3 style="margin-bottom: 16px; text-align: center;">Additional Information</h3>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; max-width: 900px; margin: 0 auto;">
        <div id="expandedLeft">
          <!-- Left side sections -->
        </div>
        <div id="expandedRight">
          <!-- Right side sections -->
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn-secondary" onclick="editItemFromView()">Edit</button>
      <button class="btn-primary" id="btnMoreInfo" onclick="toggleMoreInfo()">More Information</button>
      <button class="btn-secondary" onclick="closeModal('viewModal')">Close</button>
    </div>
  </div>
</div>

<!-- Edit Modal (Placeholder) -->
<div id="editModal" class="modal" style="display:none;">
  <div class="panel">
    <div class="modal-header">
      <h2>Edit Item</h2>
      <button onclick="closeModal('editModal')" style="background:transparent;border:none;font-size:20px;cursor:pointer;">&times;</button>
    </div>
    <p>Edit form will be displayed here...</p>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeModal('editModal')">Cancel</button>
      <button class="btn-primary">Save Changes</button>
    </div>
  </div>
</div>

<!-- Create Modal (Placeholder) -->
<div id="createModal" class="modal" style="display:none;">
  <div class="panel">
    <div class="modal-header">
      <h2>Create New Item</h2>
      <button onclick="closeModal('createModal')" style="background:transparent;border:none;font-size:20px;cursor:pointer;">&times;</button>
    </div>
    <p>Create item form will be displayed here...</p>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeModal('createModal')">Cancel</button>
      <button class="btn-primary">Create Item</button>
    </div>
  </div>
</div>

<!-- Delete Modal (Placeholder) -->
<div id="deleteModal" class="modal" style="display:none;">
  <div class="panel">
    <div class="modal-header">
      <h2>Delete Item</h2>
      <button onclick="closeModal('deleteModal')" style="background:transparent;border:none;font-size:20px;cursor:pointer;">&times;</button>
    </div>
    <p>Select items to delete...</p>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeModal('deleteModal')">Cancel</button>
      <button class="btn-danger">Delete Selected</button>
    </div>
  </div>
</div>

<script>
  // Load config and set admin link
  let config = {};
  let allItems = [];
  
  // Icon mapping for class types (placeholder icons - easily updatable)
  const CLASS_TYPE_ICONS = {
    'Cord': 'ðŸ”Œ',
    'Inflatable': 'ðŸŽˆ',
    'Plug': 'âš¡',
    'Static Prop': 'ðŸŽƒ',
    'Animatronic': 'ðŸ¤–',
    'Light': 'ðŸ’¡',
    'Adapter': 'ðŸ”§'
  };
  
  async function loadConfig() {
    try {
      const response = await fetch('config.json');
      config = await response.json();
      
      // Set admin link
      if (config.ADMIN_URL) {
        document.getElementById('adminLink').href = config.ADMIN_URL;
      }
      
      // Load items after config is loaded
      await loadItems();
    } catch (error) {
      console.error('Failed to load config:', error);
    }
  }
  
  async function loadItems() {
    try {
      const apiUrl = config.API_ENDPOINT || '';
      if (!apiUrl) {
        console.error('API_ENDPOINT not found in config');
        return;
      }
      
      const response = await fetch(`${apiUrl}/items`);
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const data = await response.json();
      allItems = data.items || [];
      
      // Filter out Storage and Deployment items
      allItems = allItems.filter(item => 
        item.class !== 'Storage' && item.class !== 'Deployment'
      );
      
      updateStats();
      renderItems();
    } catch (error) {
      console.error('Failed to load items:', error);
    }
  }
  
  function updateStats() {
    // Season stats
    const halloween = allItems.filter(i => i.season === 'Halloween').length;
    const christmas = allItems.filter(i => i.season === 'Christmas').length;
    const shared = allItems.filter(i => i.season === 'Shared').length;
    
    document.getElementById('stat-halloween').textContent = halloween;
    document.getElementById('stat-christmas').textContent = christmas;
    document.getElementById('stat-shared').textContent = shared;
    
    // Class Type stats
    document.getElementById('stat-cord').textContent = allItems.filter(i => i.class_type === 'Cord').length;
    document.getElementById('stat-inflatable').textContent = allItems.filter(i => i.class_type === 'Inflatable').length;
    document.getElementById('stat-plug').textContent = allItems.filter(i => i.class_type === 'Plug').length;
    document.getElementById('stat-static').textContent = allItems.filter(i => i.class_type === 'Static Prop').length;
    document.getElementById('stat-animatronic').textContent = allItems.filter(i => i.class_type === 'Animatronic').length;
    document.getElementById('stat-light').textContent = allItems.filter(i => i.class_type === 'Light').length;
    document.getElementById('stat-adapter').textContent = allItems.filter(i => i.class_type === 'Adapter').length;
    
    // Class stats
    document.getElementById('stat-accessory').textContent = allItems.filter(i => i.class === 'Accessory').length;
    document.getElementById('stat-decoration').textContent = allItems.filter(i => i.class === 'Decoration').length;
    document.getElementById('stat-light-class').textContent = allItems.filter(i => i.class === 'Light').length;
  }
  
  function renderItems() {
    const tableBody = document.getElementById('tableBody');
    const itemCards = document.getElementById('itemCards');
    
    tableBody.innerHTML = '';
    itemCards.innerHTML = '';
    
    allItems.forEach(item => {
      // Render table row
      const row = document.createElement('tr');
      row.innerHTML = `
        <td><span class="badge ${item.status === 'Active' ? 'active' : 'inactive'}">${item.status || 'Unknown'}</span></td>
        <td>${item.short_name || 'N/A'}</td>
        <td><span class="badge ${(item.season || '').toLowerCase()}">${item.season || 'N/A'}</span></td>
        <td>${item.class_type || 'N/A'}</td>
        <td><span class="badge ${item.repair_status?.needs_repair ? 'needs-repair' : 'ok'}">${item.repair_status?.needs_repair ? 'Needs Repair' : 'OK'}</span></td>
        <td>${item.packing_data?.tote_location || 'N/A'}</td>
        <td>
          <div class="action-buttons">
            <button class="btn-small btn-primary" onclick="viewItem('${item.id}')">View</button>
            <button class="btn-small btn-secondary" onclick="editItem('${item.id}')">Edit</button>
          </div>
        </td>
      `;
      tableBody.appendChild(row);
      
      // Render mobile card
      const card = document.createElement('div');
      card.className = 'item-card';
      card.innerHTML = `
        <div class="item-card-header">
          <div class="item-card-name">${item.short_name || 'N/A'}</div>
          <span class="badge ${item.status === 'Active' ? 'active' : 'inactive'}">${item.status || 'Unknown'}</span>
        </div>
        <div class="item-card-row">
          <span class="item-card-label">Season:</span>
          <span class="badge ${(item.season || '').toLowerCase()}">${item.season || 'N/A'}</span>
        </div>
        <div class="item-card-row">
          <span class="item-card-label">Class Type:</span>
          <span>${item.class_type || 'N/A'}</span>
        </div>
        <div class="item-card-row">
          <span class="item-card-label">Repair Status:</span>
          <span class="badge ${item.repair_status?.needs_repair ? 'needs-repair' : 'ok'}">${item.repair_status?.needs_repair ? 'Needs Repair' : 'OK'}</span>
        </div>
        <div class="item-card-row">
          <span class="item-card-label">Location:</span>
          <span>${item.packing_data?.tote_location || 'N/A'}</span>
        </div>
        <div class="action-buttons" style="margin-top: 8px;">
          <button class="btn-small btn-primary" onclick="viewItem('${item.id}')">View</button>
          <button class="btn-small btn-secondary" onclick="editItem('${item.id}')">Edit</button>
        </div>
      `;
      itemCards.appendChild(card);
    });
  }
  
  loadConfig();
  
  // Modal functions
  function viewItem(id) {
    const item = allItems.find(i => i.id === id);
    if (!item) {
      console.error('Item not found:', id);
      return;
    }
    
    // Populate ID (without "ID:" prefix)
    document.getElementById('viewItemId').textContent = item.id || 'N/A';
    
    // Populate basic fields
    document.getElementById('view-short-name').textContent = item.short_name || 'N/A';
    document.getElementById('view-season').textContent = item.season || 'N/A';
    document.getElementById('view-class').textContent = item.class || 'N/A';
    
    // Class type with icon
    const classTypeEl = document.getElementById('view-class-type');
    const icon = CLASS_TYPE_ICONS[item.class_type] || 'ðŸ“¦';
    classTypeEl.innerHTML = `<span class="type-icon">${icon}</span> ${item.class_type || 'N/A'}`;
    
    document.getElementById('view-status').textContent = item.status || 'N/A';
    document.getElementById('view-general-notes').textContent = item.general_notes || 'N/A';
    
    // Needs Repair
    const needsRepairEl = document.getElementById('view-needs-repair');
    if (item.repair_status?.needs_repair === true) {
      needsRepairEl.textContent = 'YES';
      needsRepairEl.className = 'view-field-value needs-repair-yes';
    } else {
      needsRepairEl.textContent = 'NO';
      needsRepairEl.className = 'view-field-value';
    }
    
    // Storage Location
    document.getElementById('view-tote-location').textContent = 
      item.packing_data?.tote_location || 'N/A';
    
    // Last Deployment - extract last 4 characters
    const lastDeployment = item.deployment_data?.last_deployment_id;
    if (lastDeployment) {
      const last4 = lastDeployment.slice(-4);
      document.getElementById('view-last-deployment').textContent = last4;
    } else {
      document.getElementById('view-last-deployment').textContent = 'N/A';
    }
    
    // Populate expanded content with all other fields
    populateExpandedContent(item);
    
    // Reset expanded state
    document.getElementById('expandedContent').classList.remove('show');
    document.getElementById('viewPanel').classList.remove('expanded');
    document.getElementById('btnMoreInfo').textContent = 'More Information';
    
    document.getElementById('viewModal').style.display = 'flex';
  }
  
  function populateExpandedContent(item) {
    const expandedLeft = document.getElementById('expandedLeft');
    const expandedRight = document.getElementById('expandedRight');
    expandedLeft.innerHTML = '';
    expandedRight.innerHTML = '';
    
    // LEFT SIDE - Deployment Information
    const deploySection = document.createElement('div');
    deploySection.className = 'expanded-section';
    
    const deployTitle = document.createElement('h4');
    deployTitle.textContent = 'Previous Deployments';
    deploySection.appendChild(deployTitle);
    
    if (item.deployment_data?.previous_deployments && 
        Array.isArray(item.deployment_data.previous_deployments) && 
        item.deployment_data.previous_deployments.length > 0) {
      item.deployment_data.previous_deployments.forEach(dep => {
        const listItem = document.createElement('div');
        listItem.className = 'list-item';
        listItem.style.paddingLeft = '12px';
        listItem.textContent = dep;
        deploySection.appendChild(listItem);
      });
    } else {
      const noData = document.createElement('div');
      noData.className = 'list-item';
      noData.style.paddingLeft = '12px';
      noData.textContent = 'No previous deployments';
      deploySection.appendChild(noData);
    }
    
    expandedLeft.appendChild(deploySection);
    
    // LEFT SIDE - Repair Information
    const repairSection = document.createElement('div');
    repairSection.className = 'expanded-section';
    
    const repairTitle = document.createElement('h4');
    repairTitle.textContent = 'Repair Information';
    repairSection.appendChild(repairTitle);
    
    // Last Repair Date
    const repairDateField = document.createElement('div');
    repairDateField.className = 'expanded-field';
    const repairDateLabel = document.createElement('div');
    repairDateLabel.className = 'expanded-field-label';
    repairDateLabel.textContent = 'Last Repair Date:';
    const repairDateValue = document.createElement('div');
    repairDateValue.className = 'expanded-field-value';
    repairDateValue.textContent = item.repair_status?.last_repair_date || 'N/A';
    repairDateField.appendChild(repairDateLabel);
    repairDateField.appendChild(repairDateValue);
    repairSection.appendChild(repairDateField);
    
    // Repair Notes
    const repairNotesField = document.createElement('div');
    repairNotesField.className = 'expanded-field';
    const repairNotesLabel = document.createElement('div');
    repairNotesLabel.className = 'expanded-field-label';
    repairNotesLabel.textContent = 'Repair Notes:';
    const repairNotesValue = document.createElement('div');
    repairNotesValue.className = 'expanded-field-value';
    repairNotesValue.textContent = item.repair_status?.repair_notes || 'N/A';
    repairNotesField.appendChild(repairNotesLabel);
    repairNotesField.appendChild(repairNotesValue);
    repairSection.appendChild(repairNotesField);
    
    // Repair Criticality
    const repairCritField = document.createElement('div');
    repairCritField.className = 'expanded-field';
    const repairCritLabel = document.createElement('div');
    repairCritLabel.className = 'expanded-field-label';
    repairCritLabel.textContent = 'Repair Criticality:';
    const repairCritValue = document.createElement('div');
    repairCritValue.className = 'expanded-field-value';
    repairCritValue.textContent = item.repair_status?.last_criticality || 'N/A';
    repairCritField.appendChild(repairCritLabel);
    repairCritField.appendChild(repairCritValue);
    repairSection.appendChild(repairCritField);
    
    expandedLeft.appendChild(repairSection);
    
    // RIGHT SIDE - Item Information
    const itemSection = document.createElement('div');
    itemSection.className = 'expanded-section';
    
    const itemTitle = document.createElement('h4');
    itemTitle.textContent = 'Item Information';
    itemSection.appendChild(itemTitle);
    
    // # of Tethers
    const tethersField = document.createElement('div');
    tethersField.className = 'expanded-field';
    const tethersLabel = document.createElement('div');
    tethersLabel.className = 'expanded-field-label';
    tethersLabel.textContent = '# of Tethers:';
    const tethersValue = document.createElement('div');
    tethersValue.className = 'expanded-field-value';
    tethersValue.textContent = item.tethers || 'N/A';
    tethersField.appendChild(tethersLabel);
    tethersField.appendChild(tethersValue);
    itemSection.appendChild(tethersField);
    
    // # of Stakes
    const stakesField = document.createElement('div');
    stakesField.className = 'expanded-field';
    const stakesLabel = document.createElement('div');
    stakesLabel.className = 'expanded-field-label';
    stakesLabel.textContent = '# of Stakes:';
    const stakesValue = document.createElement('div');
    stakesValue.className = 'expanded-field-value';
    stakesValue.textContent = item.stakes || 'N/A';
    stakesField.appendChild(stakesLabel);
    stakesField.appendChild(stakesValue);
    itemSection.appendChild(stakesField);
    
    // Item Height / Length
    const heightField = document.createElement('div');
    heightField.className = 'expanded-field';
    const heightLabel = document.createElement('div');
    heightLabel.className = 'expanded-field-label';
    heightLabel.textContent = 'Item Height / Length:';
    const heightValue = document.createElement('div');
    heightValue.className = 'expanded-field-value';
    heightValue.textContent = item.height_length || 'N/A';
    heightField.appendChild(heightLabel);
    heightField.appendChild(heightValue);
    itemSection.appendChild(heightField);
    
    expandedRight.appendChild(itemSection);
    
    // RIGHT SIDE - Vendor Information
    const vendorSection = document.createElement('div');
    vendorSection.className = 'expanded-section';
    
    const vendorTitle = document.createElement('h4');
    vendorTitle.textContent = 'Vendor Information';
    vendorSection.appendChild(vendorTitle);
    
    // Cost
    const costField = document.createElement('div');
    costField.className = 'expanded-field';
    const costLabel = document.createElement('div');
    costLabel.className = 'expanded-field-label';
    costLabel.textContent = 'Cost:';
    const costValue = document.createElement('div');
    costValue.className = 'expanded-field-value';
    costValue.textContent = item.vendor_metadata?.cost || 'N/A';
    costField.appendChild(costLabel);
    costField.appendChild(costValue);
    vendorSection.appendChild(costField);
    
    // Value
    const valueField = document.createElement('div');
    valueField.className = 'expanded-field';
    const valueLabel = document.createElement('div');
    valueLabel.className = 'expanded-field-label';
    valueLabel.textContent = 'Value:';
    const valueValue = document.createElement('div');
    valueValue.className = 'expanded-field-value';
    valueValue.textContent = item.vendor_metadata?.value || 'N/A';
    valueField.appendChild(valueLabel);
    valueField.appendChild(valueValue);
    vendorSection.appendChild(valueField);
    
    // Manufacturer
    const mfgField = document.createElement('div');
    mfgField.className = 'expanded-field';
    const mfgLabel = document.createElement('div');
    mfgLabel.className = 'expanded-field-label';
    mfgLabel.textContent = 'Manufacturer:';
    const mfgValue = document.createElement('div');
    mfgValue.className = 'expanded-field-value';
    mfgValue.textContent = item.vendor_metadata?.manufacturer || 'N/A';
    mfgField.appendChild(mfgLabel);
    mfgField.appendChild(mfgValue);
    vendorSection.appendChild(mfgField);
    
    // Store
    const storeField = document.createElement('div');
    storeField.className = 'expanded-field';
    const storeLabel = document.createElement('div');
    storeLabel.className = 'expanded-field-label';
    storeLabel.textContent = 'Store:';
    const storeValue = document.createElement('div');
    storeValue.className = 'expanded-field-value';
    storeValue.textContent = item.vendor_metadata?.vendor_store || 'N/A';
    storeField.appendChild(storeLabel);
    storeField.appendChild(storeValue);
    vendorSection.appendChild(storeField);
    
    expandedRight.appendChild(vendorSection);
  }
  
  function formatFieldName(key) {
    return key
      .split('_')
      .map(word => word.charAt(0).toUpperCase() + word.slice(1))
      .join(' ');
  }
  
  function formatFieldValue(value) {
    if (value === null || value === undefined) return 'N/A';
    if (typeof value === 'object') return JSON.stringify(value, null, 2);
    if (typeof value === 'boolean') return value ? 'Yes' : 'No';
    return String(value);
  }
  
  function toggleMoreInfo() {
    const expandedContent = document.getElementById('expandedContent');
    const viewPanel = document.getElementById('viewPanel');
    const btn = document.getElementById('btnMoreInfo');
    
    if (expandedContent.classList.contains('show')) {
      expandedContent.classList.remove('show');
      viewPanel.classList.remove('expanded');
      btn.textContent = 'More Information';
    } else {
      expandedContent.classList.add('show');
      viewPanel.classList.add('expanded');
      btn.textContent = 'Less Information';
    }
  }
  
  function editItemFromView() {
    closeModal('viewModal');
    // Get the current item ID from the view modal
    const idText = document.getElementById('viewItemId').textContent;
    const id = idText.replace('ID: ', '');
    editItem(id);
  }
  
  function editItem(id) {
    document.getElementById('editModal').style.display = 'flex';
  }
  
  function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
  }
  
  // Button handlers
  document.getElementById('btnCreateItem').addEventListener('click', () => {
    document.getElementById('createModal').style.display = 'flex';
  });
  
  document.getElementById('btnDeleteItem').addEventListener('click', () => {
    document.getElementById('deleteModal').style.display = 'flex';
  });
  
  document.getElementById('btnLogout').addEventListener('click', () => {
    alert('Logout clicked');
  });
  
  // Search functionality (placeholder)
  document.getElementById('searchInput').addEventListener('input', (e) => {
    console.log('Search:', e.target.value);
  });
  
  // Close modals when clicking outside
  window.addEventListener('click', (e) => {
    if (e.target.classList.contains('modal')) {
      e.target.style.display = 'none';
    }
  });
</script>

</body>
</html>