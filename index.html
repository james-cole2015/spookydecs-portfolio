<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<div id="logoutContainer" style="display:flex; justify-content:flex-end; margin-bottom:10px;">
  <button class="btn-danger" onclick="logout()">Logout</button>
</div>

<title>Admin Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; background-color: #f0f2f5; margin:0; padding:0; }
  .container { padding: 20px; }
  /* Dashboard */
  .admin-dashboard { display:none; flex-direction: column; gap: 20px; }
  .admin-dashboard h1 { font-size:2rem; margin-bottom:20px; }
  .admin-card { background-color:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); padding:16px; display:flex; align-items:center; gap:16px; transition: box-shadow 0.2s ease; }
  .admin-card:hover { box-shadow:0 4px 12px rgba(0,0,0,0.15); }
  .icon-placeholder { width:40px; height:40px; background-color:#ccc; border-radius:50%; display:flex; justify-content:center; align-items:center; font-weight:bold; font-size:1rem; }
  .card-content h3 { margin:0 0 4px 0; font-size:1.2rem; }
  .card-content p { margin:0 0 8px 0; color:#555; }
  button { padding:6px 12px; border:none; border-radius:4px; cursor:pointer; margin-right:8px; }
  button:hover { opacity:0.9; }
  .btn-primary { background-color:#007bff; color:white; }
  .btn-danger { background-color:#dc3545; color:white; }
  .search-input { padding:6px 10px; border-radius:4px; border:1px solid #ccc; width:100%; }
  @media (max-width: 768px) { .admin-card { flex-direction: column; align-items:flex-start; } }
</style>
</head>
<body>

<div class="container">

<!-- Admin Dashboard -->
<div id="adminDashboard" class="admin-dashboard">
  <h1>Admin Dashboard</h1>

  <!-- Core Feature Cards -->
  <div class="admin-card"><div class="icon-placeholder">P</div><div class="card-content"><h3>Packing Process</h3><p>Scan tote â†’ scan items â†’ assign items â†’ confirm completion.</p><button class="btn-primary" onclick="startPacking()">Start Packing</button></div></div>
  <div class="admin-card"><div class="icon-placeholder">C</div><div class="card-content"><h3>Create Item</h3><p>Use the dedicated item creation page with card-style entry and image upload.</p><button class="btn-primary" onclick="goToCreate()">Create Item</button></div></div>
  <div class="admin-card"><div class="icon-placeholder">U</div><div class="card-content"><h3>Update Item</h3><p>Edit item attributes or perform bulk updates.</p><button class="btn-primary" onclick="updateItems()">Update Items</button></div></div>
  <div class="admin-card"><div class="icon-placeholder">D</div><div class="card-content"><h3>Delete Item</h3><p>Permanently delete or archive items.</p><button class="btn-danger" onclick="deleteItems()">Delete Items</button></div></div>

  <!-- Additional Feature Cards -->
  <div class="admin-card"><div class="icon-placeholder">T</div><div class="card-content"><h3>Tote Management</h3><p>Create, update, delete totes. Move items and track details.</p><button class="btn-primary" onclick="manageTotes()">Manage Totes</button></div></div>
  <div class="admin-card"><div class="icon-placeholder">B</div><div class="card-content"><h3>Bulk Import / Export</h3><p>Import/export CSV/JSON, optional DynamoDB integration.</p><button class="btn-primary" onclick="bulkImportExport()">Import / Export</button></div></div>
  <div class="admin-card"><div class="icon-placeholder">A</div><div class="card-content"><h3>Inventory Audit</h3><p>Filter items, check missing or duplicate items.</p><button class="btn-primary" onclick="inventoryAudit()">Audit Inventory</button></div></div>
  <div class="admin-card"><div class="icon-placeholder">R</div><div class="card-content"><h3>Repair / Maintenance Tracker</h3><p>Track items needing repair; optional priority and notes.</p><button class="btn-primary" onclick="repairDashboard()">Repair Dashboard</button></div></div>
  <div class="admin-card"><div class="icon-placeholder">H</div><div class="card-content"><h3>History / Audit Logs</h3><p>View user actions with timestamps.</p><button class="btn-primary" onclick="viewLogs()">View Logs</button></div></div>
  <div class="admin-card"><div class="icon-placeholder">S</div><div class="card-content"><h3>Search & Filter</h3><p>Quick search and advanced filters.</p><input type="text" class="search-input" placeholder="Search items..."></div></div>
  <div class="admin-card"><div class="icon-placeholder">C</div><div class="card-content"><h3>Seasonal Prep / Cleanup</h3><p>Start season, archive old items, prep shopping list.</p><button class="btn-primary" onclick="startSeason()">Start Season</button><button class="btn-primary" onclick="archiveOldItems()">Archive Old Items</button><button class="btn-primary" onclick="prepShoppingList()">Prep Shopping List</button></div></div>
  <div class="admin-card"><div class="icon-placeholder">ðŸ“·</div><div class="card-content"><h3>Photo Management</h3><p>Upload and view photos of items and totes.</p><button class="btn-primary" onclick="managePhotos()">Manage Photos</button></div></div>

  

</div>
</div>

<script>
(function() {
  const USER_POOL_ID = 'us-east-2_BnxSu5LEt';
  const CLIENT_ID = '11er9f8qa7jkvgelm6hernb2ed';
  const COGNITO_DOMAIN = 'spookydecs.auth.us-east-2.amazoncognito.com'; // replace with your Cognito domain
  const adminBase = window.location.hostname.includes('dev-') ? 'https://dev-admin.spookydecs.com' : 'https://admin.spookydecs.com';

  const adminDashboard = document.getElementById('adminDashboard');

  // Helper to parse hash token from Cognito redirect
  function parseCognitoHash() {
    if (!window.location.hash) return null;
    const hash = window.location.hash.substring(1); // remove #
    const params = new URLSearchParams(hash);
    const idToken = params.get('id_token');
    return idToken;
  }

  function redirectToCognito() {
    const redirectUri = encodeURIComponent(window.location.origin);
    const url = `https://${COGNITO_DOMAIN}/login?response_type=token&client_id=${CLIENT_ID}&redirect_uri=${redirectUri}`;
    window.location.href = url;
  }

  // Main auth check
  const token = localStorage.getItem('spookydecs_id_token') || parseCognitoHash();
  if (!token) {
    redirectToCognito();
    return;
  }

  // Save token if returned from Cognito
  if (window.location.hash && token) {
    localStorage.setItem('spookydecs_id_token', token);
    // Clean URL hash
    history.replaceState(null, '', window.location.pathname);
  }

  // Decode token for basic validation
  try {
    const payload = JSON.parse(atob(token.split('.')[1]));
    const now = Math.floor(Date.now() / 1000);
    if (!payload || !payload.exp || payload.exp < (now + 15)) {
      redirectToCognito();
      return;
    }
    // token valid -> show dashboard
    adminDashboard.style.display = 'flex';
  } catch(e) {
    redirectToCognito();
  }
})();

/* ---------- Redirect to create page dynamically ---------- */
function goToCreate(){
  const hostname = window.location.hostname;
  let baseUrl = '';
  if(hostname.startsWith('dev-admin')) baseUrl = 'https://dev-admin.spookydecs.com';
  else baseUrl = 'https://admin.spookydecs.com';
  window.location.href = `${baseUrl}/create.html`;
}

/* ---------- Placeholder functions (kept unchanged) ---------- */
function startPacking(){ alert("Start Packing clicked! Connect Lambda API here."); }
function updateItems(){ alert("Update Items clicked! Connect Lambda API here."); }
function deleteItems(){ alert("Delete Items clicked! Connect Lambda API here."); }
function manageTotes(){ alert("Manage Totes clicked! Connect Lambda API here."); }
function bulkImportExport(){ alert("Bulk Import/Export clicked! Connect Lambda API here."); }
function inventoryAudit(){ alert("Inventory Audit clicked! Connect Lambda API here."); }
function repairDashboard(){ alert("Repair Dashboard clicked! Connect Lambda API here."); }
function viewLogs(){ alert("View Logs clicked! Connect Lambda API here."); }
function startSeason(){ alert("Start Season clicked! Connect Lambda API here."); }
function archiveOldItems(){ alert("Archive Old Items clicked! Connect Lambda API here."); }
function prepShoppingList(){ alert("Prep Shopping List clicked! Connect Lambda API here."); }
function managePhotos(){ alert("Manage Photos clicked! Connect Lambda API here."); }
function logout() {
  // Immediately hide dashboard and logout button
  document.getElementById('adminDashboard').style.display = 'none';
  document.getElementById('logoutContainer').style.display = 'none';

  // Clear local storage
  localStorage.removeItem('spookydecs_id_token');

  // Redirect to Cognito logout endpoint
  const CLIENT_ID = '11er9f8qa7jkvgelm6hernb2ed';
  const COGNITO_DOMAIN = 'spookydecs.auth.us-east-2.amazoncognito.com';
  const REDIRECT_URI = encodeURIComponent(window.location.origin);

  window.location.href = `https://${COGNITO_DOMAIN}/logout?client_id=${CLIENT_ID}&logout_uri=${REDIRECT_URI}`;
}

</script>

<footer>Â© 2025 spookydecs.com | Beware the 404s ðŸ‘»</footer>
</body>
</html>
