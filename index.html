<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SpookyDecs — Items Management</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<header>
  <h1>SpookyDecs — Items Management</h1>
  <div style="flex:1"></div>
  <div id="authInfo" class="small muted">Admin User</div>
  <a id="adminLink" href="#" style="color:#0f172a;text-decoration:none;padding:8px 10px;background:white;border-radius:6px;font-size:14px;border:1px solid #ddd;">Admin</a>
  <button id="btnLogout" style="background:#2b2b2b;color:white;">Logout</button>
</header>

<!-- Season Stats -->
<div class="stats-section">
  <div class="stats-label">By Season</div>
  <div class="cards">
    <div class="card">
      <div class="card-value" id="stat-halloween">12</div>
      <div class="card-label">Halloween</div>
    </div>
    <div class="card">
      <div class="card-value" id="stat-christmas">8</div>
      <div class="card-label">Christmas</div>
    </div>
    <div class="card">
      <div class="card-value" id="stat-shared">5</div>
      <div class="card-label">Shared</div>
    </div>
  </div>
</div>

<!-- Class Stats -->
<div class="stats-section">
  <div class="stats-label">By Class</div>
  <div class="cards">
    <div class="card">
      <div class="card-value" id="stat-accessory">8</div>
      <div class="card-label">Accessory</div>
    </div>
    <div class="card">
      <div class="card-value" id="stat-decoration">12</div>
      <div class="card-label">Decoration</div>
    </div>
    <div class="card">
      <div class="card-value" id="stat-light-class">5</div>
      <div class="card-label">Light</div>
    </div>
  </div>
</div>

<!-- Controls -->
<div class="controls">
  <button class="btn-create" id="btnCreateItem">+ Create Item</button>
  <button class="btn-danger" id="btnDeleteItem">Delete Item</button>
  <div style="flex:1"></div>
  <input type="text" id="searchInput" placeholder="Search items..." style="min-width: 200px;">
</div>

<!-- Desktop Table View -->
<div class="table">
  <table id="itemsTable">
    <thead>
      <tr>
        <th>Status</th>
        <th>Name</th>
        <th>Season</th>
        <th>Class Type</th>
        <th>Repair Status</th>
        <th>Location</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <!-- Items will be populated by JavaScript -->
    </tbody>
  </table>
</div>

<!-- Mobile Card View -->
<div class="item-cards" id="itemCards">
  <!-- Cards will be populated by JavaScript -->
</div>

<!-- View Modal -->
<div id="viewModal" class="modal" style="display:none;">
  <div class="panel view-panel" id="viewPanel">
    <div class="modal-header">
      <h2>Item Details</h2>
      <button onclick="closeModal('viewModal')" style="background:transparent;border:none;font-size:20px;cursor:pointer;">&times;</button>
    </div>
    
    <div class="view-item-id" id="viewItemId">ITEM-XXX-XXXX</div>
    
    <div class="view-content">
      <div class="view-section">
        <h3>Basic Information</h3>
        <div class="view-field">
          <div class="view-field-label">Name:</div>
          <div class="view-field-value" id="view-short-name">-</div>
        </div>
        <div class="view-field">
          <div class="view-field-label">Season:</div>
          <div class="view-field-value" id="view-season">-</div>
        </div>
        <div class="view-field">
          <div class="view-field-label">Class:</div>
          <div class="view-field-value" id="view-class">-</div>
        </div>
        <div class="view-field">
          <div class="view-field-label">Type:</div>
          <div class="view-field-value" id="view-class-type">-</div>
        </div>
      </div>
      
      <div class="view-section">
        <h3>Status & Location</h3>
        <div class="view-field">
          <div class="view-field-label">Status:</div>
          <div class="view-field-value" id="view-status">-</div>
        </div>
        <div class="view-field">
          <div class="view-field-label">Needs Repair:</div>
          <div class="view-field-value" id="view-needs-repair">-</div>
        </div>
        <div class="view-field">
          <div class="view-field-label">Item Notes:</div>
          <div class="view-field-value" id="view-general-notes">-</div>
        </div>
        <div class="view-field">
          <div class="view-field-label">Storage Location:</div>
          <div class="view-field-value" id="view-tote-location">-</div>
        </div>
        <div class="view-field">
          <div class="view-field-label">Last Deployment:</div>
          <div class="view-field-value" id="view-last-deployment">-</div>
        </div>
      </div>
    </div>
    
    <div class="expanded-content" id="expandedContent">
      <h3 style="margin-bottom: 16px; text-align: center;">Additional Information</h3>
      <div style="display: grid; grid-template-columns: repeat(2,max-content); justify-content: center; gap: 200px; max-width: 900px; margin: 0 auto;">
        <div id="expandedLeft"></div>
        <div id="expandedRight"></div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn-secondary" onclick="editItemFromView()">Edit</button>
      <button class="btn-primary" id="btnMoreInfo" onclick="toggleMoreInfo()">More Information</button>
      <button class="btn-secondary" onclick="closeModal('viewModal')">Close</button>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal" style="display:none;">
  <div class="panel edit-panel">
    <div class="modal-header">
      <h2 id="editModalTitle">Edit Item</h2>
      <button onclick="closeModal('editModal')" style="background:transparent;border:none;font-size:20px;cursor:pointer;">&times;</button>
    </div>
    
    <!-- Edit Form View -->
    <div id="editFormView" class="edit-view">
      <form id="editForm">
        
        <!-- Basic Information Section -->
        <div class="accordion-section">
          <button type="button" class="accordion-header" onclick="toggleAccordion(this)">
            <span>Basic Information</span>
            <span class="accordion-icon">▼</span>
          </button>
          <div class="accordion-content active">
            <div class="form-group">
              <label for="edit-short-name">Name <span class="required">*</span></label>
              <input type="text" id="edit-short-name" name="short_name" required>
            </div>
            
            <div class="form-group">
              <label for="edit-season">Season <span class="required">*</span></label>
              <select id="edit-season" name="season" required>
                <option value="">Select Season</option>
                <option value="Halloween">Halloween</option>
                <option value="Christmas">Christmas</option>
                <option value="Shared">Shared</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="edit-class">Class <span class="required">*</span></label>
              <select id="edit-class" name="class" required>
                <option value="">Select Class</option>
                <option value="Accessory">Accessory</option>
                <option value="Decoration">Decoration</option>
                <option value="Light">Light</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="edit-class-type">Class Type <span class="required">*</span></label>
              <input type="text" id="edit-class-type" name="class_type" readonly disabled>
              <div class="field-hint">Class Type cannot be changed</div>
            </div>
            
            <div class="form-group">
              <label for="edit-status">Status <span class="required">*</span></label>
              <select id="edit-status" name="status" required>
                <option value="">Select Status</option>
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
              </select>
            </div>
          </div>
        </div>
        
        <!-- Item Details Section (Dynamic) -->
        <div class="accordion-section" id="itemDetailsSection">
          <button type="button" class="accordion-header" onclick="toggleAccordion(this)">
            <span>Item Details</span>
            <span class="accordion-icon">▼</span>
          </button>
          <div class="accordion-content">
            <div id="dynamicFields">
              <!-- Dynamic fields will be inserted here based on class_type -->
            </div>
          </div>
        </div>
        
        <!-- Vendor Information Section -->
        <div class="accordion-section">
          <button type="button" class="accordion-header" onclick="toggleAccordion(this)">
            <span>Vendor Information</span>
            <span class="accordion-icon">▼</span>
          </button>
          <div class="accordion-content">
            <div class="form-group">
              <label for="edit-cost">Cost</label>
              <input type="text" id="edit-cost" name="cost" placeholder="e.g., $29.99">
            </div>
            
            <div class="form-group">
              <label for="edit-value">Value</label>
              <input type="text" id="edit-value" name="value" placeholder="e.g., $50.00">
            </div>
            
            <div class="form-group">
              <label for="edit-manufacturer">Manufacturer</label>
              <input type="text" id="edit-manufacturer" name="manufacturer">
            </div>
            
            <div class="form-group">
              <label for="edit-store">Store</label>
              <input type="text" id="edit-store" name="vendor_store">
            </div>
          </div>
        </div>
        
        <!-- Storage & Deployment Section -->
        <div class="accordion-section">
          <button type="button" class="accordion-header" onclick="toggleAccordion(this)">
            <span>Storage & Deployment</span>
            <span class="accordion-icon">▼</span>
          </button>
          <div class="accordion-content">
            <div class="form-group">
              <label for="edit-tote-location">Storage Location</label>
              <input type="text" id="edit-tote-location" name="tote_location" placeholder="e.g., Garage - A3">
            </div>
            
            <div class="form-group">
              <label for="edit-general-notes">Item Notes</label>
              <textarea id="edit-general-notes" name="general_notes" rows="3"></textarea>
            </div>
            
            <div class="form-group">
              <label for="edit-last-deployment">Last Deployment</label>
              <input type="text" id="edit-last-deployment" name="last_deployment" readonly disabled>
              <div class="field-hint">Managed by deployment system</div>
            </div>
          </div>
        </div>
        
      </form>
    </div>
    
    <!-- Preview View -->
    <div id="editPreviewView" class="edit-view" style="display:none;">
      <!-- Preview content will be generated dynamically -->
    </div>
    
    <div class="modal-footer">
      <button class="btn-secondary" id="editCancelBtn" onclick="closeModal('editModal')">Cancel</button>
      <button class="btn-primary" id="editPreviewBtn" onclick="showEditPreview()">Preview Changes</button>
      <button class="btn-secondary" id="editBackBtn" onclick="backToEditForm()" style="display:none;">Back to Edit</button>
      <button class="btn-primary" id="editSaveBtn" onclick="saveEditChanges()" style="display:none;">Confirm & Save</button>
    </div>
  </div>
</div>

<!-- Create Modal -->
<div id="createModal" class="modal" style="display:none;">
  <div class="panel edit-panel">
    <div class="modal-header">
      <h2 id="createModalTitle">Create New Item</h2>
      <button onclick="closeModal('createModal')" style="background:transparent;border:none;font-size:20px;cursor:pointer;">&times;</button>
    </div>
    
    <!-- Create Form View -->
    <div id="createFormView" class="edit-view">
      <form id="createForm">
        
        <!-- Basic Information Section -->
        <div class="accordion-section">
          <button type="button" class="accordion-header" onclick="toggleAccordion(this)">
            <span>Basic Information</span>
            <span class="accordion-icon">▼</span>
          </button>
          <div class="accordion-content active">
            <div class="form-group">
              <label for="create-short-name">Name <span class="required">*</span></label>
              <input type="text" id="create-short-name" name="short_name" required>
            </div>
            
            <div class="form-group">
              <label for="create-season">Season <span class="required">*</span></label>
              <select id="create-season" name="season" required>
                <option value="">Select Season</option>
                <option value="Halloween">Halloween</option>
                <option value="Christmas">Christmas</option>
                <option value="Shared">Shared</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="create-class">Class <span class="required">*</span></label>
              <select id="create-class" name="class" required onchange="onCreateClassChange()">
                <option value="">Select Class</option>
                <option value="Decoration">Decoration</option>
                <option value="Accessory">Accessory</option>
                <option value="Light">Light</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="create-class-type">Class Type <span class="required">*</span></label>
              <select id="create-class-type" name="class_type" required disabled onchange="onCreateClassTypeChange()">
                <option value="">Select Class Type</option>
              </select>
              <div class="field-hint">Select a Class first</div>
            </div>
            
            <div class="form-group">
              <label for="create-status">Status</label>
              <select id="create-status" name="status">
                <option value="Active" selected>Active</option>
                <option value="Inactive">Inactive</option>
              </select>
              <div class="field-hint">Defaults to Active</div>
            </div>
            <!-- Add this checkbox field in your create form's "Basic Information" section -->
            <!-- Place it AFTER the "Status" dropdown and BEFORE the "Item Notes" textarea -->

            <div class="form-group">
              <label for="create-deployed">
                <input type="checkbox" id="create-deployed" name="deployed" style="width: auto; margin-right: 8px;">
                Currently Deployed
              </label>
              <div class="field-hint">Check if this item is currently deployed in your display</div>
            </div>

            <div class="form-group">
              <label for="create-general-notes">Item Notes</label>
              <textarea id="create-general-notes" name="general_notes" rows="3"></textarea>
            </div>
          </div>
        </div>
        
        <!-- Item Details Section (Dynamic) -->
        <div class="accordion-section" id="createItemDetailsSection">
          <button type="button" class="accordion-header" onclick="toggleAccordion(this)">
            <span>Item Details</span>
            <span class="accordion-icon">▼</span>
          </button>
          <div class="accordion-content">
            <div id="createDynamicFields">
              <div class="field-hint" style="text-align: center; padding: 20px;">
                Select a Class Type to see additional fields
              </div>
            </div>
          </div>
        </div>
        
        <!-- Vendor Information Section -->
        <div class="accordion-section">
          <button type="button" class="accordion-header" onclick="toggleAccordion(this)">
            <span>Vendor Information</span>
            <span class="accordion-icon">▼</span>
          </button>
          <div class="accordion-content">
            <div class="form-group">
              <label for="create-cost">Cost</label>
              <input type="text" id="create-cost" name="cost" placeholder="e.g., $29.99">
            </div>
            
            <div class="form-group">
              <label for="create-value">Value</label>
              <input type="text" id="create-value" name="value" placeholder="e.g., $50.00">
            </div>
            
            <div class="form-group">
              <label for="create-manufacturer">Manufacturer</label>
              <input type="text" id="create-manufacturer" name="manufacturer">
            </div>
            
            <div class="form-group">
              <label for="create-store">Store</label>
              <input type="text" id="create-store" name="vendor_store">
            </div>
          </div>
        </div>
        
        <!-- Storage Section -->
        <div class="accordion-section">
          <button type="button" class="accordion-header" onclick="toggleAccordion(this)">
            <span>Storage</span>
            <span class="accordion-icon">▼</span>
          </button>
          <div class="accordion-content">
            <div class="form-group">
              <label for="create-tote-location">Storage Location</label>
              <input type="text" id="create-tote-location" name="tote_location" placeholder="e.g., Garage - A3">
            </div>
          </div>
        </div>
        
      </form>
    </div>
    
    <!-- Preview View -->
    <div id="createPreviewView" class="edit-view" style="display:none;">
      <!-- Preview content will be generated dynamically -->
    </div>
    
    <div class="modal-footer">
      <button class="btn-secondary" id="createCancelBtn" onclick="closeModal('createModal')">Cancel</button>
      <button class="btn-primary" id="createPreviewBtn" onclick="showCreatePreview()">Preview</button>
      <button class="btn-secondary" id="createBackBtn" onclick="backToCreateForm()" style="display:none;">Back to Edit</button>
      <button class="btn-primary" id="createSaveBtn" onclick="saveNewItem()" style="display:none;">Create Item</button>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div id="deleteModal" class="modal" style="display:none;">
  <div class="panel">
    <div class="modal-header">
      <h2>Delete Item</h2>
      <button onclick="closeModal('deleteModal')" style="background:transparent;border:none;font-size:20px;cursor:pointer;">&times;</button>
    </div>
    <p>Select items to delete...</p>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeModal('deleteModal')">Cancel</button>
      <button class="btn-danger">Delete Selected</button>
    </div>
  </div>
</div>

<!-- JavaScript Modules - Load in order of dependencies -->
<script src="config.js"></script>
<script src="api-service.js"></script>
<script src="ui-renderer.js"></script>
<script src="view-modal.js"></script>
<script src="edit-form.js"></script>
<script src="edit-preview.js"></script>
<script src="edit-save.js"></script>
<script src="create-modal.js"></script>
<!--<script src="filter-system.js"></script> -->
<script src="event-handlers.js"></script>

</body>
</html>