<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SpookyDecs - Repair Management</title>
  <link rel="stylesheet" href="styles.css">
<link rel="icon" type="image/svg+xml" href="https://spooky-decs-shared-assets.s3.us-east-2.amazonaws.com/icons/admin-gear_icon.svg?v=3"></head>
<body>
  <header>
    <h1>SpookyDecs — Repair Management</h1>
    <div style="flex:1"></div>
    <div id="authInfo" class="small muted">Admin User</div>
    <a id="adminLink" href="#" style="color:#0f172a;text-decoration:none;padding:8px 10px;background:white;border-radius:6px;font-size:14px;border:1px solid #ddd;">Admin</a>
    <button id="btnLogout" style="background:#2b2b2b;color:white;">Logout</button>
  </header>

  <main>
    <!-- Navigation Tabs -->
    <div class="tabs">
      <button class="tab active" data-view="queue">Repair Queue</button>
      <button class="tab" data-view="flag">Flag for Repair</button>
      <button class="tab" data-view="history">Repair History</button>
      <button class="tab" data-view="analytics">Analytics</button>
    </div>

    <!-- View: Repair Queue -->
    <div id="viewQueue" class="view active">
      <div class="view-header">
        <h2>Items Needing Repair</h2>
        <div class="filters">
          <select id="filterCriticality" class="filter-select">
            <option value="">All Criticality</option>
            <option value="Critical">Critical</option>
            <option value="High">High</option>
            <option value="Medium">Medium</option>
            <option value="Low">Low</option>
          </select>
          <select id="filterStatus" class="filter-select">
            <option value="">All Status</option>
            <option value="Needs Repair">Needs Repair</option>
            <option value="In Repair">In Repair</option>
          </select>
          <select id="filterClassType" class="filter-select">
            <option value="">All Types</option>
            <option value="Inflatable">Inflatable</option>
            <option value="Animatronic">Animatronic</option>
            <option value="Static">Static</option>
            <option value="Lighting">Lighting</option>
          </select>
        </div>
      </div>

      <div id="repairQueueStats" class="stats-row">
        <div class="stat-card critical">
          <div class="stat-value">0</div>
          <div class="stat-label">Critical</div>
        </div>
        <div class="stat-card high">
          <div class="stat-value">0</div>
          <div class="stat-label">High</div>
        </div>
        <div class="stat-card medium">
          <div class="stat-value">0</div>
          <div class="stat-label">Medium</div>
        </div>
        <div class="stat-card low">
          <div class="stat-value">0</div>
          <div class="stat-label">Low</div>
        </div>
      </div>

      <div id="repairQueueContainer">
        <div class="loading">Loading repairs...</div>
      </div>
    </div>

    <!-- View: Flag for Repair -->
    <div id="viewFlag" class="view">
      <div class="view-header">
        <h2>Flag Item for Repair</h2>
      </div>

      <div class="flag-layout">
        <!-- Left: Search Form -->
        <div class="flag-search-section">
          <div class="form-container">
            <div class="form-section">
              <label for="flagItemId">Search by Item ID</label>
              <input type="text" id="flagItemId" placeholder="e.g., INF-4S-8T-001" />
              <button id="btnSearchItem" class="btn-secondary">Search Item</button>
            </div>

            <div id="flagItemPreview" style="display:none;">
              <div class="item-preview-card">
                <h3 id="previewName">Item Name</h3>
                <div class="preview-details">
                  <span id="previewClass">Class</span> • 
                  <span id="previewType">Type</span> • 
                  <span id="previewStatus">Status</span>
                </div>
              </div>

              <div class="form-section">
                <label for="flagCriticality">Criticality Level *</label>
                <select id="flagCriticality" required>
                  <option value="Medium">Medium</option>
                  <option value="Low">Low</option>
                  <option value="High">High</option>
                  <option value="Critical">Critical</option>
                </select>
              </div>

              <div class="form-section">
                <label for="flagNotes">Inspection Notes</label>
                <textarea id="flagNotes" rows="4" placeholder="Describe the issue..."></textarea>
              </div>

              <div class="form-section">
                <label for="flagEstimatedCost">Estimated Repair Cost ($)</label>
                <input type="number" id="flagEstimatedCost" step="0.01" min="0" placeholder="0.00" />
              </div>

              <div class="form-actions">
                <button id="btnFlagItem" class="btn-primary">Flag for Repair</button>
                <button id="btnCancelFlag" class="btn-secondary">Cancel</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Right: Browse Items Table -->
        <div class="flag-table-section">
          <div class="flag-table-header">
            <h3>Browse Items</h3>
            <input type="text" id="filterFlagTable" class="filter-select" placeholder="Filter by name..." style="max-width: 250px;">
          </div>

          <div id="flagTableContainer">
            <div class="loading">Loading items...</div>
          </div>

          <div id="flagTablePagination" class="pagination" style="display:none;">
            <button id="btnFlagPrev" class="btn-small btn-secondary">← Previous</button>
            <span id="flagPageInfo" class="page-info">Page 1 of 1</span>
            <button id="btnFlagNext" class="btn-small btn-secondary">Next →</button>
          </div>
        </div>
      </div>
    </div>

    <!-- View: Repair History -->
    <div id="viewHistory" class="view">
      <div class="view-header">
        <h2>Repair History</h2>
        <div class="filters">
          <select id="filterHistoryType" class="filter-select">
            <option value="">All Types</option>
            <option value="repair">Repairs</option>
            <option value="inspection">Inspections</option>
            <option value="retired">Retired</option>
          </select>
          <input type="text" id="searchHistoryItem" class="filter-select" placeholder="Search by item ID or name..." style="min-width: 200px;">
        </div>
      </div>

      <div id="historyStatsRow" class="stats-row" style="grid-template-columns: repeat(3, 1fr);">
        <div class="stat-card">
          <div class="stat-value">0</div>
          <div class="stat-label">Total Repairs</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">$0.00</div>
          <div class="stat-label">Total Cost</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">0</div>
          <div class="stat-label">Items Serviced</div>
        </div>
      </div>

      <div id="repairHistoryContainer">
        <div class="loading">Loading repair history...</div>
      </div>
    </div>

    <!-- View: Analytics -->
    <div id="viewAnalytics" class="view">
      <div class="view-header">
        <h2>Repair Analytics</h2>
      </div>

      <div class="analytics-grid">
        <div class="analytics-card">
          <h3>Summary</h3>
          <div id="analyticsSummary">
            <div class="summary-item">
              <span class="summary-label">Total Items Needing Repair</span>
              <span class="summary-value" id="totalNeedingRepair">-</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Currently In Repair</span>
              <span class="summary-value" id="totalInRepair">-</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Total Repairs Completed</span>
              <span class="summary-value" id="totalRepairsCompleted">-</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Estimated Repair Costs</span>
              <span class="summary-value" id="totalEstimatedCost">-</span>
            </div>
          </div>
        </div>

        <div class="analytics-card">
          <h3>Most Frequently Repaired Items</h3>
          <div id="frequentRepairsChart">
            <div class="loading">Analyzing data...</div>
          </div>
        </div>

        <div class="analytics-card">
          <h3>Repairs by Criticality</h3>
          <div id="criticalityChart">
            <div class="loading">Loading chart...</div>
          </div>
        </div>

        <div class="analytics-card">
          <h3>Average Repair Time</h3>
          <div id="avgRepairTime">
            <div class="loading">Calculating...</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Modal: Repair Detail View -->
  <div id="modalRepairDetail" class="modal" style="display:none;">
    <div class="panel view-panel">
      <div class="modal-header">
        <h2>Repair Details</h2>
        <button class="close-btn" onclick="closeRepairDetailModal()">&times;</button>
      </div>

      <div class="view-item-id" id="detailItemId">-</div>

      <div class="view-content">
        <div class="view-section">
          <h3>Item Information</h3>
          <div class="view-field">
            <div class="view-field-label">Short Name</div>
            <div class="view-field-value" id="detailShortName">-</div>
          </div>
          <div class="view-field">
            <div class="view-field-label">Class</div>
            <div class="view-field-value" id="detailClass">-</div>
          </div>
          <div class="view-field">
            <div class="view-field-label">Type</div>
            <div class="view-field-value" id="detailClassType">-</div>
          </div>
          <div class="view-field">
            <div class="view-field-label">Status</div>
            <div class="view-field-value" id="detailStatus">-</div>
          </div>
        </div>

        <div class="view-section">
          <h3>Repair Status</h3>
          <div class="view-field">
            <div class="view-field-label">Needs Repair</div>
            <div class="view-field-value" id="detailNeedsRepair">-</div>
          </div>
          <div class="view-field">
            <div class="view-field-label">Criticality</div>
            <div class="view-field-value" id="detailCriticality">-</div>
          </div>
          <div class="view-field">
            <div class="view-field-label">Repair Status</div>
            <div class="view-field-value" id="detailRepairStatus">-</div>
          </div>
          <div class="view-field">
            <div class="view-field-label">Started Date</div>
            <div class="view-field-value" id="detailStartedDate">-</div>
          </div>
          <div class="view-field">
            <div class="view-field-label">Last Repair</div>
            <div class="view-field-value" id="detailLastRepair">-</div>
          </div>
          <div class="view-field">
            <div class="view-field-label">Est. Cost</div>
            <div class="view-field-value" id="detailEstCost">-</div>
          </div>
        </div>
      </div>

      <div class="view-section" style="margin-top: 24px;">
        <h3>Repair History</h3>
        <div id="detailRepairHistory">
          <p class="muted">No repair history available.</p>
        </div>
      </div>

      <div class="modal-footer">
        <button id="btnStartRepair" class="btn-primary" style="display:none;">Start Repair</button>
        <button id="btnCompleteRepair" class="btn-success" style="display:none;">Complete Repair</button>
        <button id="btnRetireItem" class="btn-danger" style="display:none;">Retire Item</button>
        <button class="btn-secondary" onclick="closeRepairDetailModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- Modal: Complete Repair Form -->
  <div id="modalCompleteRepair" class="modal" style="display:none;">
    <div class="panel">
      <div class="modal-header">
        <h2>Complete Repair</h2>
        <button class="close-btn" onclick="closeCompleteRepairModal()">&times;</button>
      </div>

      <div class="form-section">
        <label for="completeDescription">Repair Description *</label>
        <textarea id="completeDescription" rows="4" placeholder="Describe what was repaired..." required></textarea>
      </div>

      <div class="form-section">
        <label for="completeCost">Actual Cost ($)</label>
        <input type="number" id="completeCost" step="0.01" min="0" placeholder="0.00" />
      </div>

      <div class="form-section">
        <label for="completePerformedBy">Performed By</label>
        <input type="text" id="completePerformedBy" placeholder="Your name" />
      </div>

      <div class="modal-footer">
        <button id="btnSubmitComplete" class="btn-success">Complete Repair</button>
        <button class="btn-secondary" onclick="closeCompleteRepairModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="repairs-config.js"></script>
  <script src="repairs-api.js"></script>
  <script src="repairs-ui.js"></script>
  <script src="repairs-queue.js"></script>
  <script src="repairs-history.js"></script>
  <script src="repairs-analytics.js"></script>
  <script src="repairs-main.js"></script>
</body>
</html>