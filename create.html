<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Create Item | Admin</title>
<style>
  body { font-family: Arial, sans-serif; background-color: #f0f2f5; margin:0; padding:20px; }
  .create-preview { background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.08); max-width:500px; margin:auto; }
  .field-row { margin-bottom:10px; }
  .field-label { font-weight:600; margin-right:6px; }
  input { padding:6px 10px; border-radius:4px; border:1px solid #ccc; width:100%; }
  button { padding:8px 12px; border:none; border-radius:4px; cursor:pointer; background-color:#007bff; color:white; }
  button:hover { opacity:0.9; }
</style>
</head>
<body>

<div class="create-preview">
  <h2>Create New Item</h2>
  <div class="field-row"><span class="field-label">Name:</span><input type="text" id="newItemName" placeholder="Item Name"></div>
  <div class="field-row"><span class="field-label">Category:</span><input type="text" id="newItemCategory" placeholder="Category"></div>
  <div class="field-row"><span class="field-label">Tote ID:</span><input type="text" id="newItemTote" placeholder="Tote ID"></div>
  <div class="field-row"><span class="field-label">Image:</span><input type="file" id="newItemImage" accept="image/*"></div>
  <div class="field-row"><button onclick="submitNewItem()">Create</button><span id="createItemMessage" style="margin-left:10px;color:#333;"></span></div>
</div>

<script>
function getJwt(){ return localStorage.getItem('jwtToken'); }

async function submitNewItem(){
  const jwt = getJwt();
  if(!jwt){ alert('You must be logged in.'); return; }

  const name = document.getElementById('newItemName').value;
  const category = document.getElementById('newItemCategory').value;
  const tote = document.getElementById('newItemTote').value;
  const fileInput = document.getElementById('newItemImage');
  const msg = document.getElementById('createItemMessage');

  if(!name || !category || !tote || !fileInput.files[0]) { msg.textContent = 'All fields are required.'; return; }

  try {
    const canvas = document.createElement('canvas'); 
    const ctx = canvas.getContext('2d'); 
    const bitmap = await createImageBitmap(fileInput.files[0]);
    canvas.width=bitmap.width; canvas.height=bitmap.height; 
    ctx.drawImage(bitmap,0,0); 
    const webpBlob = await new Promise(res=>canvas.toBlob(res,'image/webp',0.8));

    // TODO: Replace with real API call
    console.log('Submitting new item:', { name, category, tote, webpBlob });

    msg.textContent = `Item "${name}" ready to upload (simulate Lambda API call).`;
  } catch(e){
    console.error('Create Item error:', e); 
    msg.textContent = 'Failed to process image.';
  }
}
</script>

</body>
</html>
